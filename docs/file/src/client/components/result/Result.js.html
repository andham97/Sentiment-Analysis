<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../../../">
  <title data-ice="title">src/client/components/result/Result.js | sentiment-analysis</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/andham97/Sentiment-Analysis"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client">client</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components">client/components</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/Button.js~Button.html">Button</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/Card.js~Card.html">Card</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/Checkbox.js~Checkbox.html">Checkbox</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/DatePickerInterval.js~DatePickerInterval.html">DatePickerInterval</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/ErrorBoundary.js~ErrorBoundary.html">ErrorBoundary</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/Filter.js~Filter.html">Filter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/LoadingPage.js~LoadingPage.html">LoadingPage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/TimeInterval.js~TimeInterval.html">TimeInterval</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components-admin">client/components/admin</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/admin/AdminPanelStore.js~AdminPanelStore.html">AdminPanelStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/admin/MultiListInput.js~MultiListInput.html">MultiListInput</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/admin/Scraper.js~Scraper.html">Scraper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AdminPanelContext">AdminPanelContext</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components-dashboard">client/components/dashboard</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/dashboard/Dashboard.js~Dashboard.html">Dashboard</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/dashboard/SearchStore.js~SearchStore.html">SearchStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SearchContext">SearchContext</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components-result">client/components/result</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/NewsArticle.js~NewsArticle.html">NewsArticle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/NewsArticleSentiment.js~NewsArticle.html">NewsArticle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/NoResult.js~NoResult.html">NoResult</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/Parameters.js~Paramteres.html">Paramteres</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/Result.js~Result.html">Result</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/ResultSentiment.js~ResultSentiment.html">ResultSentiment</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components-result-graph">client/components/result/graph</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/graph/DonutChart.js~DonutChart.html">DonutChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ProgressBar">ProgressBar</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server">server</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-connectCloudant">connectCloudant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCloudant">getCloudant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-start">start</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-newsapi">newsapi</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-nlu">nlu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-server">server</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server-routes">server/routes</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isWhitelisted">isWhitelisted</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server-ws">server/ws</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-index">index</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-nlu">nlu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadIndex">loadIndex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ws">ws</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/client/components/result/Result.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import React, { Component } from &apos;react&apos;;
import {
  LineChart, Line, XAxis, YAxis, CartesianGrid, Tooltip, Legend,
} from &apos;recharts&apos;;
import stt from &apos;search-text-tokenizer&apos;;
import Alert from &apos;react-s-alert&apos;;
import Card from &apos;../Card&apos;;
import Header from &apos;../Header&apos;;
import DatePickerInterval from &apos;../DatePickerInterval&apos;;
import DonutChart from &apos;./graph/DonutChart&apos;;
import Parameteres from &apos;./Parameters&apos;;
import &apos;../style/Result.css&apos;;
import NewsArticle from &apos;./NewsArticle&apos;;
import Dropdown from &apos;../Dropdown&apos;;
import Checkbox from &apos;../Checkbox&apos;;
import Button from &apos;../Button&apos;;
import { SearchContext } from &apos;../dashboard/SearchStore&apos;;

const classNameMap = (name) =&gt; {
  switch (name) {
    case &apos;anger&apos;:
      return &apos;anger&apos;;
    case &apos;sadness&apos;:
      return &apos;sadness&apos;;
    case &apos;fear&apos;:
      return &apos;fear&apos;;
    case &apos;joy&apos;:
      return &apos;joy&apos;;
    case &apos;disgust&apos;:
      return &apos;disgust&apos;;
    default:
      return [];
  }
};

const coloranger = &apos;#E26D5A&apos;;
const colorfear = &apos;#3A405A&apos;;
const colorjoy = &apos;#D3C0CD&apos;;
const colorsad = &apos;#3D70B2&apos;;
const colordisgust = &apos;#9FAF90&apos;;

class Result extends Component {
  constructor(props) {
    super(props);
    this.state = {
      averageArray: [],
      checkedEmotion: [],
      etSelection: false,
    };
    this.handleCheckedEmotion = this.handleCheckedEmotion.bind(this);
  }

  componentWillMount() {
    if (!this.context.search &amp;&amp; localStorage.getItem(&apos;prev-search&apos;))
      this.context.getSearch(localStorage.getItem(&apos;prev-search&apos;));
    this.setState({
      ...this.state,
      checkedEmotion: [...this.context.searchOpts.checkedItemsEmotion],
    });
  }

  makeRedirect(url) {
    if (typeof url !== &apos;undefined&apos;) {
      window.open(url, &apos;_blank&apos;);
    }
  }

  handleCheckedEmotion(emotion) {
    const item = emotion.target.value;
    const isChecked = emotion.target.checked;
    const cs = this.state.checkedEmotion;
    if (isChecked &amp;&amp; cs.indexOf(item) === -1)
      cs.push(item);
    else if (!isChecked &amp;&amp; cs.indexOf(item) &gt; -1)
      cs.splice(cs.indexOf(item), 1);
    this.setState({ ...this.state, checkedEmotion: cs });
  }

  dateChange(date) {
    const opts = JSON.parse(JSON.stringify(this.context.searchOpts));
    let startDate = !date || !date.startDate ? this.state.startDate : date.startDate;
    let endDate = !date || !date.endDate ? this.state.endDate : date.endDate;
    if (!date) {
      startDate = new Date(0);
      endDate = new Date();
    }
    if (!startDate)
      startDate = this.context.searchOpts.startDate;
    if (!endDate)
      endDate = this.context.searchOpts.endDate;
    if (!startDate.getTime)
      startDate = new Date(startDate);
    if (!endDate.getTime)
      endDate = new Date(endDate);
    startDate.setHours(0);
    startDate.setMinutes(0);
    startDate.setSeconds(0);
    endDate.setHours(23);
    endDate.setMinutes(59);
    endDate.setSeconds(59);
    startDate = startDate.getTime();
    endDate = endDate.getTime();
    if (date &amp;&amp; date.startDate &amp;&amp; this.context.search.docs[this.context.search.docs.length - 1]
      .date - (24 * 60 * 60 * 1000) &gt; startDate &amp;&amp; this.state.startDate)
      Alert.warning(&apos;Provided &quot;from&quot; date is outside current search results&apos;, { position: &apos;top&apos; });
    else if (date &amp;&amp; date.endDate &amp;&amp; this.context.search.docs[0]
      .date + (24 * 60 * 60 * 1000) &lt; endDate &amp;&amp; this.state.endDate)
      Alert.warning(&apos;Provided &quot;to&quot; date is outside current search results&apos;, { position: &apos;top&apos; });
    opts.startDate = startDate;
    opts.endDate = endDate;
    this.context.computeSearch(this.context.search, opts);
  }

  render() {
    let { startDate, endDate } = this.state;
    if (!startDate)
      startDate = this.context.searchOpts.startDate;
    if (!endDate)
      endDate = this.context.searchOpts.endDate;
    if (startDate.getTime)
      startDate = startDate.getTime();
    if (endDate.getTime)
      endDate = endDate.getTime();
    const emotionSearch = this.state.checkedEmotion.length === 0
      ? this.context.search.docs : this.context.search.docs
        .filter(item =&gt; item.analysis.emotion
          &amp;&amp; this.state.checkedEmotion.indexOf(Object.keys(item.analysis.emotion)
            .sort((a, b) =&gt; Math.abs(item.analysis.emotion[b])
              - Math.abs(item.analysis.emotion[a]))[0]) &gt; -1);
    const filterEmotion = ((startDate || endDate)
      ? emotionSearch.filter(doc =&gt; (startDate ? doc.date &gt;= startDate : true)
        &amp;&amp; (endDate ? doc.date &lt;= endDate : true)) : emotionSearch)
      .filter(item =&gt; item.analysis.emotion);
    return (
      &lt;React.Fragment&gt;
        &lt;Header class=&apos;result_header&apos; name=&apos;Sentiment Analysis&apos; /&gt;
        &lt;div className = &apos;result&apos;&gt;
          &lt;div className = &apos;result_filter&apos;&gt;
              &lt;div className= &apos;filter_bar&apos;&gt;
                &lt;div className=&apos;test&apos;&gt;
                  &lt;Dropdown className=&apos;clickable&apos; titleList=&apos;Emotion&apos; items={
                    this.context.graphData.map((item, i) =&gt; &lt;Checkbox
                        key={i}
                        id={item.title}
                        value={item.title[0].toUpperCase() + item.title.slice(1)}
                        checked={this.state.checkedEmotion.indexOf(item.title) &gt; -1}
                        onChange={emotion =&gt; this.handleCheckedEmotion(emotion)}
                      /&gt;)
                  } /&gt;
                  &lt;Dropdown className=&apos;clickable&apos; titleList=&apos;Date Interval&apos; items={&lt;DatePickerInterval change={(date) =&gt; {
                    this.setState({
                      ...this.state,
                      etSelection: false,
                      startDate: date.startDate === null ? undefined : date.startDate,
                      endDate: date.endDate === null ? undefined : date.endDate,
                    });
                    this.dateChange({
                      startDate: date.startDate === null
                        ? this.context.search.docs[this.context.search.docs.length - 1].date
                        : date.startDate,
                      endDate: date.endDate === null
                        ? this.context.search.docs[0].date
                        : date.endDate,
                    });
                  }} startDate={this.state.startDate ? new Date(this.state.startDate) : undefined}
                  endDate={this.state.endDate ? new Date(this.state.endDate) : undefined} /&gt;} /&gt;
                &lt;/div&gt;
                &lt;div&gt;
                  &lt;Button className=&apos;exportpdf&apos; title=&apos;Print result&apos; onClick={() =&gt; {
                    window.print();
                  }} /&gt;
                &lt;/div&gt;
              &lt;/div&gt;
          &lt;/div&gt;

          &lt;div className = &apos;result_parameters&apos;&gt;
            &lt;Card&gt;
              &lt;div className=&apos;title_param&apos;&gt;Parameters&lt;/div&gt;
              &lt;div className=&apos;param_card&apos;&gt;
                &lt;Parameteres
                  searchtext={stt(this.context.searchOpts.search.replace(/[^a-zA-Z\s-]/g, &apos;&apos;))
                    .reduce((acc, val) =&gt; {
                      if (acc !== &apos;&apos;)
                        acc += &apos;, &apos;;
                      if (val.exclude)
                        acc += `-${val.term}`;
                      else if (val.phrase)
                        acc += `&quot;${val.term}&quot;`;
                      else
                        acc += val.term;
                      return acc;
                    }, &apos;&apos;)}
                  sentiment={`Emotion: ${this.state.checkedEmotion.length === 0
                    ? &apos;Joy, Anger, Disgust, Sadness, Fear&apos;
                    : `${this.state.checkedEmotion.slice(0, -1)
                      .map(s =&gt; s[0].toUpperCase() + s.slice(1)).join(&apos;, &apos;)}${this.state.checkedEmotion.slice(0, -1).length &gt; 0
                      ? &apos;, &apos;
                      : &apos;&apos;}${this.state.checkedEmotion.slice(-1).map(s =&gt; s[0].toUpperCase() + s.slice(1))[0]}`}`}
                  timeinterval={`Date Interval: ${new Date(this.state.startDate ? this.state.startDate : filterEmotion[filterEmotion.length - 1].date).toLocaleDateString()} - ${new Date(endDate).toLocaleDateString()}`}
                  amount={`Amount: ${filterEmotion.length}`}
                  emotion={this.context.searchOpts.show}
                  emotionClick={() =&gt; {
                    const opts = JSON.parse(JSON.stringify(this.context.searchOpts));
                    opts.show = !opts.show;
                    this.context.computeSearch(this.context.search, opts);
                  }}
                /&gt;
              &lt;/div&gt;
            &lt;/Card&gt;
          &lt;/div&gt;

            {this.context.graphData.map((element, i) =&gt; {
              const name = classNameMap(element.title);
              return (&lt;div key={i} align=&quot;center&quot; className = {`result_graphs_${name} clickable clickable-color`}&gt;
                &lt;Card onClick={() =&gt; {
                  if (this.state.checkedEmotion[0] === name
                    &amp;&amp; this.state.checkedEmotion.length === 1)
                    return this.setState({ ...this.state, checkedEmotion: [] });
                  this.setState({
                    ...this.state,
                    checkedEmotion: [name],
                  });
                }}&gt;
                  &lt;div className=&apos;graphs&apos; &gt;
                    &lt;DonutChart chart={`${name}_chart`} label={`label_${name}`} name={element.title} data={[element]}/&gt;
                  &lt;/div&gt;
                &lt;/Card&gt;
              &lt;/div&gt;);
            })}

          &lt;div className = &apos;result_graph&apos;&gt;
            &lt;Card&gt;
            &lt;div className=&apos;emotionalTone&apos;&gt;Emotional Tone&lt;/div&gt;
              &lt;LineChart
                width={350}
                height={300}
                data={this.context.emotionalTone}
                margin={{
                  top: 20,
                }} onClick={(data) =&gt; {
                  if (this.state.etSelection) {
                    this.setState({
                      ...this.state,
                      etSelection: false,
                      startDate: undefined,
                      endDate: undefined,
                    });
                    this.dateChange();
                  }
                  else if (data
                    &amp;&amp; data.activePayload
                    &amp;&amp; data.activePayload[0]
                    &amp;&amp; data.activePayload[0].payload
                    &amp;&amp; data.activePayload[0].payload.time) {
                    const sd = new Date(data.activePayload[0].payload.time);
                    const ed = new Date(data.activePayload[0].payload.time);
                    sd.setHours(0);
                    sd.setMinutes(0);
                    sd.setSeconds(0);
                    ed.setHours(23);
                    ed.setMinutes(59);
                    ed.setSeconds(59);
                    this.setState({
                      ...this.state,
                      etSelection: true,
                      startDate: sd,
                      endDate: ed,
                    });
                    this.dateChange({
                      startDate: sd,
                      endDate: ed,
                    });
                  }
                }}&gt;
                &lt;XAxis dataKey=&quot;date&quot;/&gt;
                &lt;YAxis/&gt;
                &lt;CartesianGrid strokeDasharray=&quot;3 3&quot;/&gt;
                &lt;Tooltip/&gt;
                &lt;Legend /&gt;
                &lt;Line type=&quot;monotone&quot; name=&quot;Anger&quot; dataKey=&quot;emotions.anger.perc&quot; stroke={coloranger} activeDot={{ r: 8 }}/&gt;
                &lt;Line type=&quot;monotone&quot; name=&quot;Joy&quot; dataKey=&quot;emotions.joy.perc&quot; stroke={colorjoy} /&gt;
                &lt;Line type=&quot;monotone&quot; name=&quot;Fear&quot; dataKey=&quot;emotions.fear.perc&quot; stroke={colorfear} /&gt;
                &lt;Line type=&quot;monotone&quot; name=&quot;Sadness&quot; dataKey=&quot;emotions.sadness.perc&quot; stroke={colorsad} /&gt;
                &lt;Line type=&quot;monotone&quot; name=&quot;Disgust&quot; dataKey=&quot;emotions.disgust.perc&quot; stroke={colordisgust} /&gt;
              &lt;/LineChart&gt;
            &lt;/Card&gt;
          &lt;/div&gt;

          &lt;div className = &apos;result_news&apos;&gt;
            &lt;Card&gt;
            { filterEmotion.length === 0 ? &apos;No articles found with provided filters&apos; : filterEmotion.map((item, i) =&gt; &lt;NewsArticle
              key={i}
              date={new Date(item.date).toLocaleDateString()}
              title={item.headline}
              newssource={item.sourceID}
              domFeeling={item.analysis.emotion ? Object.keys(item.analysis.emotion)
                .sort((a, b) =&gt; item.analysis.emotion[b] - item.analysis.emotion[a])[0] : &apos;None&apos;}
              feelings= {item.analysis.emotion ? item.analysis.emotion : {
                anger: 0, joy: 0, disgust: 0, fear: 0, sadness: 0,
              }}
              onClick= {() =&gt; this.makeRedirect(item.url)}
            /&gt;) }
            &lt;/Card&gt;
          &lt;/div&gt;
        &lt;/div&gt;
      &lt;/React.Fragment&gt;
    );
  }
}

Result.contextType = SearchContext;

export default Result;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
