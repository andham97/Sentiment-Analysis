<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <base data-ice="baseUrl" href="../../../">
  <title data-ice="title">src/server/scheduler.js | sentiment-analysis</title>
  <link type="text/css" rel="stylesheet" href="css/style.css">
  <link type="text/css" rel="stylesheet" href="css/prettify-tomorrow.css">
  <script src="script/prettify/prettify.js"></script>
  <script src="script/manual.js"></script>
</head>
<body class="layout-container" data-ice="rootContainer">

<header>
  <a href="./">Home</a>
  
  <a href="identifiers.html">Reference</a>
  <a href="source.html">Source</a>
  
  <div class="search-box">
  <span>
    <img src="./image/search.png">
    <span class="search-input-edge"></span><input class="search-input"><span class="search-input-edge"></span>
  </span>
    <ul class="search-result"></ul>
  </div>
<a style="position:relative; top:3px;" href="https://github.com/andham97/Sentiment-Analysis"><img width="20px" src="./image/github.png"></a></header>

<nav class="navigation" data-ice="nav"><div>
  <ul>
    
  <li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client">client</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/App.js~App.html">App</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components">client/components</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/Button.js~Button.html">Button</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/Card.js~Card.html">Card</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/Checkbox.js~Checkbox.html">Checkbox</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/DatePickerInterval.js~DatePickerInterval.html">DatePickerInterval</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/ErrorBoundary.js~ErrorBoundary.html">ErrorBoundary</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/Filter.js~Filter.html">Filter</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/LoadingPage.js~LoadingPage.html">LoadingPage</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/TimeInterval.js~TimeInterval.html">TimeInterval</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components-admin">client/components/admin</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/admin/AdminPanelStore.js~AdminPanelStore.html">AdminPanelStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/admin/MultiListInput.js~MultiListInput.html">MultiListInput</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/admin/Scraper.js~Scraper.html">Scraper</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-AdminPanelContext">AdminPanelContext</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components-dashboard">client/components/dashboard</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/dashboard/Dashboard.js~Dashboard.html">Dashboard</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/dashboard/SearchStore.js~SearchStore.html">SearchStore</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-SearchContext">SearchContext</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components-result">client/components/result</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/NewsArticle.js~NewsArticle.html">NewsArticle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/NewsArticleSentiment.js~NewsArticle.html">NewsArticle</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/NoResult.js~NoResult.html">NoResult</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/Parameters.js~Paramteres.html">Paramteres</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/Result.js~Result.html">Result</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/ResultSentiment.js~ResultSentiment.html">ResultSentiment</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#client-components-result-graph">client/components/result/graph</a><span data-ice="kind" class="kind-class">C</span><span data-ice="name"><span><a href="class/src/client/components/result/graph/DonutChart.js~DonutChart.html">DonutChart</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ProgressBar">ProgressBar</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server">server</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-connectCloudant">connectCloudant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-getCloudant">getCloudant</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-start">start</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-newsapi">newsapi</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-nlu">nlu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-variable">V</span><span data-ice="name"><span><a href="variable/index.html#static-variable-server">server</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server-routes">server/routes</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-isWhitelisted">isWhitelisted</a></span></span></li>
<li data-ice="doc"><a data-ice="dirPath" class="nav-dir-path" href="identifiers.html#server-ws">server/ws</a><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-index">index</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-nlu">nlu</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-loadIndex">loadIndex</a></span></span></li>
<li data-ice="doc"><span data-ice="kind" class="kind-function">F</span><span data-ice="name"><span><a href="function/index.html#static-function-ws">ws</a></span></span></li>
</ul>
</div>
</nav>

<div class="content" data-ice="content"><h1 data-ice="title">src/server/scheduler.js</h1>
<pre class="source-code line-number raw-source-code"><code class="prettyprint linenums" data-ice="content">import uuid from &apos;uuid/v1&apos;;
import API from &apos;./api&apos;;
import ws from &apos;./ws&apos;;
import nluProcess from &apos;./ws/nlu&apos;;

const interval = 60;
let schedule = [];
let activeSchedule = [];
const ignoreIDs = [];
let selfInvoked = [];
const selfStop = [];
const toggle = {
  update: false,
  schedule: true,
  run: true,
};

const msToString = (ms) =&gt; {
  const hrs = Math.floor(ms / (60 * 60 * 1000));
  ms -= hrs * 60 * 60 * 1000;
  return `${hrs}h ${Math.floor(ms / (60 * 1000))}min`;
};

class Timeout {
  constructor(fn, wait) {
    this.wait = wait;
    if (wait === -1)
      return;
    this.executed = false;
    this.id = setTimeout(() =&gt; {
      fn(() =&gt; {
        this.executed = true;
      });
    }, wait);
  }

  stop() {
    clearTimeout(this.id);
  }
}

const getTimeToNextRun = (item) =&gt; {
  const ref = new Date();
  return item.occurences.map((val) =&gt; {
    const occ = new Date(Date.UTC(
      ref.getUTCFullYear(),
      ref.getUTCMonth(),
      ref.getUTCDate(),
      val.hour,
      val.minute,
      val.second,
    ));
    return occ.getTime() + (occ.getTime() &lt;= ref.getTime() ? (24 * 60 * 60 * 1000) : 0);
  }).sort((a, b) =&gt; a - b)[0] - ref.getTime();
};

const run = item =&gt; ((cb) =&gt; {
  console.log(`Executing ${item.id ? item.id : &apos;independent job&apos;}`);
  if (item.recurring) {
    activeSchedule = activeSchedule.filter(i =&gt; item.id !== i);
    activeSchedule.push({
      id: item.id,
      timeout: new Timeout(run(item), getTimeToNextRun(item)),
      recurring: item.recurring,
      timestamp: new Date().getTime(),
    });
  }
  else if (item.id &amp;&amp; selfInvoked.filter(i =&gt; item.id === i.id).length === 0) {
    API.deleteScheduleItem(item.id).then(() =&gt; {
      schedule = schedule.filter(i =&gt; i.id !== item.id);
    }).catch(() =&gt; {});
  }
  else if (item.id &amp;&amp; selfInvoked.filter(i =&gt; item.id === i.id).length &gt; 0) {
    selfInvoked = selfInvoked.filter(i =&gt; item.id !== i.id);
  }
  (() =&gt; {
    if (item.task === &apos;all&apos;)
      return new Promise(resolve =&gt; API.getWebscraperSources()
        .then(srcs =&gt; resolve(srcs.map(h =&gt; h.key)))
        .catch(() =&gt; resolve([])));
    return new Promise(resolve =&gt; resolve(item.task));
  })().then((sources) =&gt; {
    console.log(sources);
    API.getNewsSourceURLs(sources).then((urls) =&gt; {
      API.urlCheck(urls).then((list) =&gt; {
        if (cb)
          cb();
        else
          console.log(`Fetching ${list.length}/${urls.length} articles`);
        if (list.length &gt; 0) {
          let count = 0;
          let err = 0;
          ws(list, (data) =&gt; {
            count++;
            if (count === list.length)
              console.log(`URLs processed: ${count} Number of errors: ${!data ? (err + 1) : err}`);
            if (!data) {
              err++;
              return;
            }
            nluProcess(data, () =&gt; {});
          });
        }
      }).catch((err) =&gt; {
        console.error(err);
      });
    });
  });
});

const update = (extra) =&gt; {
  activeSchedule.forEach((item) =&gt; {
    if (item.timeout.executed &amp;&amp; !item.recurring)
      ignoreIDs.push(item.id);
  });
  activeSchedule = activeSchedule
    .filter(aItem =&gt; schedule
      .filter(item =&gt; item.id === aItem.id &amp;&amp; !aItem.timeout.executed).length &gt; 0)
    .filter(aItem =&gt; (aItem.timeout.wait + aItem.timestamp) - new Date().getTime() &gt;= 0);
  schedule
    .filter(item =&gt; activeSchedule
      .filter(aItem =&gt; aItem.id === item.id).length === 0
      &amp;&amp; ignoreIDs.indexOf(item.id) === -1
      &amp;&amp; selfStop.indexOf(item.id) === -1)
    .forEach((item) =&gt; {
      activeSchedule.push({
        id: item.id,
        timeout: new Timeout(run(item), getTimeToNextRun(item)),
        recurring: item.recurring,
        timestamp: new Date().getTime(),
      });
    });
  ignoreIDs.forEach((id) =&gt; {
    API.deleteScheduleItem(id).then(() =&gt; {
      ignoreIDs.splice(ignoreIDs.indexOf(id), 1);
      schedule = schedule.filter(item =&gt; item.id !== id);
    }).catch(() =&gt; {});
  });
  if (toggle.update) {
    console.log(`Active scheduled jobs: ${activeSchedule.length}`);
    activeSchedule.forEach(item =&gt; console.log(`${item.id}\n\tTime until invocation: ${msToString((item.timeout.wait + item.timestamp) - new Date().getTime())}`));
  }
  API.getWebscraperHosts().then(() =&gt; {}).catch(console.error);
  if (!extra)
    setTimeout(update, interval * 1000);
};

const processInput = (data) =&gt; {
  data = data.toString(&apos;utf-8&apos;).split(&apos; &apos;)
    .filter(s =&gt; s !== &apos;&apos;).join(&apos; &apos;)
    .split(&apos;\n&apos;)
    .filter(cmd =&gt; cmd !== &apos;&apos;);
  data.forEach((line) =&gt; {
    if (line.split(&apos; &apos;)[0] === &apos;s&apos;)
      line = `schedule ${line.split(&apos; &apos;).slice(1).join(&apos; &apos;)}`;
    else if (line.split(&apos; &apos;)[0] === &apos;r&apos;)
      line = `run ${line.split(&apos; &apos;).slice(1).join(&apos; &apos;)}`;
    else if (line.split(&apos; &apos;)[0] === &apos;t&apos;)
      line = `toggle ${line.split(&apos; &apos;).slice(1).join(&apos; &apos;)}`;
    if (line.indexOf(&apos;schedule&apos;) === 0) {
      const command = line.split(&apos; &apos;)[1];
      const options = line.split(&apos; &apos;).slice(2);
      switch (command) {
        case &apos;get&apos;:
          if (toggle.schedule)
            console.log(&apos;Fetching new updated schedule&apos;);
          API.getSchedule().then((ns) =&gt; {
            const curIDs = schedule.map(item =&gt; item.id);
            ns.filter(item =&gt; curIDs.indexOf(item.id) === -1).forEach(item =&gt; schedule.push(item));
            update(true);
            if (toggle.schedule)
              console.log(&apos;Schedule updated&apos;);
          }).catch(() =&gt; console.log(&apos;Not possible to get schedule&apos;));
          break;
        case &apos;delete&apos;:
          if (schedule.filter(item =&gt; item.id === options[0]).length === 0
            &amp;&amp; selfInvoked.filter(ii =&gt; ii.id === options[0]).length === 0)
            console.log(&apos;ID not recognized&apos;);
          else if (selfInvoked.filter(ii =&gt; ii.id === options[0]).length &gt; 0) {
            if (toggle.schedule)
              console.log(&apos;Deleting job&apos;);
            selfInvoked.forEach((item) =&gt; {
              if (item.id === options[0])
                item.timeout.stop();
            });
            selfInvoked = selfInvoked.filter(item =&gt; item.id !== options[0]);
            console.log(&apos;Job deleted&apos;);
          }
          else {
            if (toggle.schedule)
              console.log(&apos;Deleting job&apos;);
            API.deleteScheduleItem(options[0]).then(() =&gt; {
              activeSchedule.forEach((item) =&gt; {
                if (item.id === options[0])
                  item.timeout.stop();
              });
              activeSchedule = activeSchedule.filter(item =&gt; item.id !== options[0]);
              console.log(&apos;Job deleted&apos;);
            }).catch(() =&gt; console.log(&apos;Deletion not possible&apos;));
          }
          break;
        case &apos;add&apos;:
          if (options[1] !== &apos;true&apos; &amp;&amp; options[1] !== &apos;false&apos;)
            console.log(&apos;recurring option must be true or false&apos;);
          else if (options.slice(2, 5)
            .filter(num =&gt; isNaN(num) || Number(num) &gt; 59 || Number(num) &lt; 0).length &gt; 0
            || Number(options[2]) &gt; 23
            || Number(options[2]) &lt; 0)
            console.log(&apos;Parameter 3, 4 and 5 must be numbers and between 0 0 0 and 23 59 59&apos;);
          else {
            API.addScheduleItem({
              recurring: options[1] === &apos;true&apos;,
              task: options[0],
              occurences: [{
                hour: Number(options[2]),
                minute: Number(options[3]),
                second: Number(options[4]),
              }],
            }).then((item) =&gt; {
              console.log(&apos;Job addded&apos;);
              if (toggle.schedule)
                console.log(item);
            }).catch((err) =&gt; {
              console.log(&apos;Job not added&apos;);
              console.log(err);
            });
          }
          break;
        case &apos;show&apos;:
          if (options.length &gt; 0 &amp;&amp; options[0] === &apos;all&apos;) {
            console.log(`All central scheduled jobs: ${schedule.length}`);
            schedule.forEach(item =&gt; console.log(`${item.id}\n\t${item.occurences.map(i =&gt; `${i.hour &lt; 10 ? `0${i.hour}` : i.hour}:${i.minute &lt; 10 ? `0${i.minute}` : i.minute}:${i.second &lt; 10 ? `0${i.second}` : i.second}`).join(&apos;\n\t&apos;)}`));
          }
          else {
            console.log(`Active scheduled jobs: ${activeSchedule.length}`);
            activeSchedule.forEach(item =&gt; console.log(`${item.id}\n\tTime until invocation: ${msToString((item.timeout.wait + item.timestamp) - new Date().getTime())}`));
          }
          break;
        case &apos;help&apos;:
        case &apos;h&apos;:
          console.log(
            `Usage:
\t- schedule get (force a fetch of the central schedule)
\t- schedule add &lt;task&gt; &lt;recurring (true | false)&gt; &lt;hour&gt; &lt;minute&gt; &lt;second&gt; (add task to central schedule)
\t- schedule delete &lt;job-id&gt; (delete the specified task from local and remote schedule)
\t- schedule help (show this command description)`,
          );
          break;
        default:
          console.log(&apos;Command not recognized&apos;);
      }
    }
    else if (line.indexOf(&apos;run&apos;) === 0 &amp;&amp; line.split(&apos; &apos;).length &gt; 1) {
      const options = line.split(&apos; &apos;).slice(1);
      const items = schedule.filter(item =&gt; item.id === options[0]);
      if (items.length &gt; 0) {
        items.forEach(item =&gt; run(item)());
        console.log(&apos;Job invoked&apos;);
      }
      else if (options.length === 4) {
        if (options.slice(1, 4)
          .filter(num =&gt; isNaN(num) || Number(num) &gt; 59 || Number(num) &lt; 0).length &gt; 0
          || Number(options[1]) &gt; 23
          || Number(options[1]) &lt; 0)
          console.log(&apos;Parameter 2, 3 and 4 must be numbers and between 0 0 0 and 23 59 59&apos;);
        else {
          const nItem = {
            id: uuid(),
            recurring: false,
            task: options[0],
            occurences: [{
              hour: Number(options[1]),
              minute: Number(options[2]),
              second: Number(options[3]),
            }],
          };
          selfInvoked.push({
            id: nItem.id,
            recurring: nItem.recurring,
            timestamp: new Date().getTime(),
            timeout: new Timeout(run(nItem), getTimeToNextRun(nItem)),
          });
          console.log(`Added job:\n${toggle.run ? JSON.stringify(nItem, null, 2) : &apos;&apos;}\n`);
        }
      }
      else if (options.length === 2 &amp;&amp; options[1] === &apos;now&apos;) {
        run({
          task: options[0],
        })();
        console.log(&apos;Task invoked&apos;);
      }
      else if (options.length === 2 &amp;&amp; options[0] === &apos;stop&apos;) {
        if (options[1] === &apos;show&apos;)
          selfStop.forEach(id =&gt; console.log(id));
        else if (activeSchedule.filter(item =&gt; item.id === options[1]).length &gt; 0) {
          const item = activeSchedule.filter(i =&gt; i.id === options[1])[0];
          item.timeout.stop();
          activeSchedule = activeSchedule.filter(i =&gt; item.id !== i.id);
          selfStop.push(item.id);
          console.log(&apos;Job stopped&apos;);
        }
      }
      else if (options.length === 2 &amp;&amp; options[0] === &apos;start&apos;) {
        if (options[1] === &apos;show&apos;)
          selfStop.forEach(id =&gt; console.log(id));
        else if (selfStop.indexOf(options[1]) &gt; -1) {
          const item = schedule.filter(i =&gt; i.id === options[1])[0];
          activeSchedule.push({
            id: item.id,
            timeout: new Timeout(run(item), getTimeToNextRun(item)),
            recurring: item.recurring,
            timestamp: new Date().getTime(),
          });
          console.log(&apos;Job started&apos;);
        }
      }
      else if (options.length === 1 &amp;&amp; options[0] === &apos;show&apos;) {
        console.log(`Locally scheduled jobs: ${selfInvoked.length}\n`);
        selfInvoked.forEach(item =&gt; console.log(`${item.id}\n\tTime until invocation: ${msToString((item.timeout.wait + item.timestamp) - new Date().getTime())}`));
        console.log(&apos;&apos;);
      }
      else if (options.length === 1 &amp;&amp; (options[0] === &apos;help&apos; || options[0] === &apos;h&apos;)) {
        console.log(
          `Usage:
\t- run &lt;job-id&gt; (run the job with the ID provided now)
\t- run &lt;task&gt; now (run the specified task now)
\t- run &lt;task&gt; &lt;hour&gt; &lt;minute&gt; &lt;second&gt; (schedule a local task at the specified time)
\t- run start &lt;job-id&gt; (start the specified job)
\t- run stop &lt;job-id&gt; (stop the specified job from running locally)
\t- run start show (print central jobs stopped locally)
\t- run stop show (print central jobs stopped locally)
\t- run show (print the locally scheduled jobs)
\t- run help (show this command description)`,
        );
      }
      else if (options.length === 1)
        console.log(&apos;ID not recognized&apos;);
      else if (options.length &lt; 4 || options.length &gt; 5)
        console.log(&apos;Command not recognized&apos;);
    }
    else if (line.indexOf(&apos;help&apos;) === 0 || line.split(&apos; &apos;)[0] === &apos;h&apos;) {
      console.log(
        `Commands (for usage pass &apos;help&apos; as first parameter to command)
\t- schedule
\t- run
\t- toggle
\t- help`,
      );
    }
    else if (line.indexOf(&apos;toggle&apos;) === 0) {
      const label = line.split(&apos; &apos;)[1];
      if (label === &apos;help&apos; || label === &apos;h&apos;)
        console.log(`
          Usage:
\t- toggle &lt;label&gt; (toggles the output label)
\t\t- update (the ongoing update)
\t\t- schedule
\t\t- run
\t\t- all (toggle all labels)
\t- toggle help (display this help section)`);
      else if (label === &apos;all&apos;) {
        const tk = Object.keys(toggle).filter(key =&gt; !toggle[key]).length &gt; 0;
        Object.keys(toggle).forEach((key) =&gt; {
          toggle[key] = tk;
        });
        console.log(`All labels set to ${tk}`);
      }
      else if (label === &apos;show&apos;)
        console.log(toggle);
      else if (toggle[label] || toggle[label] === false) {
        toggle[label] = !toggle[label];
        console.log(`${label} set to ${toggle[label]}`);
      }
    }
    else
      console.log(&apos;Command not recognized, try \&apos;help\&apos; command&apos;);
    update(true);
  });
};

const start = () =&gt; {
  console.log(&apos;Starting scheduler&apos;);
  API.registerScheduleListener((items) =&gt; {
    if (!items)
      return;
    schedule = items;
  });
  const ft = () =&gt; {
    API.getSchedule().then((data) =&gt; {
      data.forEach(item =&gt; schedule.push(item));
      update();
      console.log(&apos;Scheduler commandline tool is ready:&apos;);
      process.stdin.on(&apos;data&apos;, processInput);
    }).catch(() =&gt; {
      if (schedule.length === 0)
        setTimeout(ft, 2000);
    });
  };
  setTimeout(ft, 2000);
};

export default start;
</code></pre>

</div>

<footer class="footer">
  Generated by <a href="https://esdoc.org">ESDoc<span data-ice="esdocVersion">(1.1.0)</span><img src="./image/esdoc-logo-mini-black.png"></a>
</footer>

<script src="script/search_index.js"></script>
<script src="script/search.js"></script>
<script src="script/pretty-print.js"></script>
<script src="script/inherited-summary.js"></script>
<script src="script/test-summary.js"></script>
<script src="script/inner-link.js"></script>
<script src="script/patch-for-local.js"></script>
</body>
</html>
